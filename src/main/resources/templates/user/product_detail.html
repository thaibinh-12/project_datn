<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
        integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" type="text/css" th:href="@{/css/product_detail.css}">
    <title>About us</title>
</head>

<body>
    <div th:replace="fragment/header_footer :: header"></div>

    <div class="container mb-5">
        <div class="container mb-5">
            <div class="row">
                <!-- Product Info Header -->
                <div class="card-header">
                    <h5 class="text-dark">Thông tin sản phẩm</h5>
                </div>

                <div class="card-body d-flex">
                    <div class="col-sm-6">
                        <div class="card">
                            <div class="card-body text-center">
                                <img id="product-image" alt="Product Image" width="350" height="300">
                            </div>
                        </div>
                    </div>

                    <div class="col-sm-6">
                        <div class="product-info">
                            <h2 id="product-name"></h2>
                            <p>Brand: <span id="product-brand"></span></p>
                            <p>Type: <span id="product-type"></span></p>
                            <p>Status: <span id="product-status"></span></p>

                            <label>Size:</label>
                            <div id="size-options" class="d-flex">
                                <!-- Size options will be injected here -->
                            </div>

                            <div id="color-options" class="d-flex">
                                <!-- Tùy chọn màu sắc sẽ được chèn vào đây -->
                            </div>

                            <div id="price-and-quantity">
                                <p>Price: <span id="product-price"></span></p>
                                <p><span id="product-quantity"></span></p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Product Description Section -->
                <div class="card">
                    <h5>Mô tả</h5>
                    <p id="product-description"></p>
                </div>
            </div>

            <div class="mt-4">
                <div class="row">
                    <div class="col-sm-12">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title text-dark">Đánh giá từ khách hàng</h5>
                                <div class="mb-3">
                                    <div class="border p-2 mb-2 bg-light shadow">
                                        <i class="fa-solid fa-face-smile"></i> <strong class="text-dark">Nguyễn Thị
                                            Hoa</strong>
                                        <div class="ms-3">
                                            <i class="fa-solid fa-star" style="color: rgba(255, 208, 0, 0.933);"></i>
                                            <i class="fa-solid fa-star" style="color: rgba(255, 208, 0, 0.933);"></i>
                                            <i class="fa-solid fa-star" style="color: rgba(255, 208, 0, 0.933);"></i>
                                            <i class="fa-solid fa-star" style="color: rgba(255, 208, 0, 0.933);"></i>
                                            <i class="fa-solid fa-star" style="color: rgba(255, 208, 0, 0.933);"></i>
                                        </div>
                                        <p class="ms-3 mt-3 text-dark">Sản phẩm chất lượng! Thời gian giao hàng nhanh
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="container mt-5">
            <div class="d-flex flex-column align-items-center text-center mb-3">
                <h4 class="mt-2 text-dark">Sản phẩm liên quan</h4>
            </div>

            <div class="row row-cols-1 row-cols-md-4 g-4 mb-5">
                <div class="col">
                    <div class="product-card text-center position-relative">
                        <img src="https://assets.adidas.com/images/h_840,f_auto,q_auto,fl_lossy,c_fill,g_auto/3bbecbdf584e40398446a8bf0117cf62_9366/Giay_Samba_OG_trang_B75806_01_00_standard.jpg"
                            class="product-img mx-auto mt-2" alt="Product Image" loading="lazy"
                            style="width: 100%; height: auto;">
                        <div class="product-info">
                            <h6 class="product-category text-secondary">Giày thể thao</h6>
                            <h6 class="product-name text-dark">Tên sản phẩm</h6>
                            <h5 class="product-price text-primary fw-bold ms-2 text-dark">1,200,000₫</h5>
                            <div class="hover-content">
                                <button class="btn btn-outline-primary text-dark">Xem chi tiết</button>
                                <button class="btn btn-outline-secondary text-dark">Thêm vào yêu thích</button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Lặp lại phần tử sản phẩm để hiển thị 4 sản phẩm -->
                <div class="col">
                    <div class="product-card text-center position-relative">
                        <img src="https://assets.adidas.com/images/h_840,f_auto,q_auto,fl_lossy,c_fill,g_auto/3bbecbdf584e40398446a8bf0117cf62_9366/Giay_Samba_OG_trang_B75806_01_00_standard.jpg"
                            class="product-img mx-auto mt-2" alt="Product Image" loading="lazy"
                            style="width: 100%; height: auto;">
                        <div class="product-info">
                            <h6 class="product-category text-secondary">Giày thể thao</h6>
                            <h6 class="product-name">Tên sản phẩm</h6>
                            <h5 class="product-price text-primary fw-bold ms-2">1,200,000₫</h5>
                            <div class="hover-content">
                                <button class="btn btn-outline-primary">Xem chi tiết</button>
                                <button class="btn btn-outline-secondary">Thêm vào yêu thích</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="product-card text-center position-relative">
                        <img src="https://assets.adidas.com/images/h_840,f_auto,q_auto,fl_lossy,c_fill,g_auto/3bbecbdf584e40398446a8bf0117cf62_9366/Giay_Samba_OG_trang_B75806_01_00_standard.jpg"
                            class="product-img mx-auto mt-2" alt="Product Image" loading="lazy"
                            style="width: 100%; height: auto;">
                        <div class="product-info">
                            <h6 class="product-category text-secondary ">Giày thể thao</h6>
                            <h6 class="product-name">Tên sản phẩm</h6>
                            <h5 class="product-price text-primary fw-bold ms-2 text-dark">1,200,000₫</h5>
                            <div class="hover-content">
                                <button class="btn btn-outline-primary">Xem chi tiết</button>
                                <button class="btn btn-outline-secondary">Thêm vào yêu thích</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="product-card text-center position-relative">
                        <img src="https://assets.adidas.com/images/h_840,f_auto,q_auto,fl_lossy,c_fill,g_auto/3bbecbdf584e40398446a8bf0117cf62_9366/Giay_Samba_OG_trang_B75806_01_00_standard.jpg"
                            class="product-img mx-auto mt-2" alt="Product Image" loading="lazy"
                            style="width: 100%; height: auto;">
                        <div class="product-info">
                            <h6 class="product-category text-secondary">Giày thể thao</h6>
                            <h6 class="product-name text-dark">Tên sản phẩm</h6>
                            <h5 class="product-price text-primary fw-bold ms-2 text-dark">1,200,000₫</h5>
                            <div class="hover-content">
                                <button class="btn btn-outline-primary">Xem chi tiết</button>
                                <button class="btn btn-outline-secondary">Thêm vào yêu thích</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div th:replace="fragment/header_footer :: footer"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous">

        </script>
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const productId = urlParams.get('id');
        let variants = [];

        // Fetch product details and variants
        fetch(`http://localhost:8081/api/products/${productId}`)
            .then(response => response.json())
            .then(product => {
                document.getElementById('product-name').textContent = product.name;
                document.getElementById('product-brand').textContent = product.brand;
                document.getElementById('product-type').textContent = product.type;
                document.getElementById('product-description').textContent = product.description;
                document.getElementById('product-image').src = product.image;
                document.getElementById('product-status').textContent = product.status === 1 ? 'Còn hàng' : 'Hết hàng';
                variants = product.variants; // Lưu trữ tất cả các variant

                // Hiển thị các tùy chọn size
                const sizeOptionsDiv = document.getElementById('size-options');
                const uniqueSizes = [...new Set(variants.map(v => v.size))]; // Lấy tất cả các size unique
                uniqueSizes.forEach(size => {
                    const label = document.createElement('label');
                    label.classList.add('me-3');
                    label.innerHTML = `<input type="radio" name="size" value="${size}" class="form-check-input"> ${size}`;
                    sizeOptionsDiv.appendChild(label);
                });

                // Cập nhật giá và số lượng cho variant đầu tiên
                if (variants.length > 0) {
                    updatePriceAndQuantity(variants[0].size, variants[0].color);
                }
            })
            .catch(error => console.error('Error fetching product details:', error));

        // Xử lý sự kiện chọn size
        document.getElementById('size-options').addEventListener('change', function () {
            const selectedSize = document.querySelector('input[name="size"]:checked')?.value;
            if (!selectedSize) return;

            const colorOptionsDiv = document.getElementById('color-options');
            colorOptionsDiv.innerHTML = ''; // Xóa các tùy chọn màu cũ
            colorOptionsDiv.disabled = false;

            // Lọc các variant theo size đã chọn
            const filteredVariants = variants.filter(v => v.size === selectedSize);

            // Hiển thị các tùy chọn màu sắc theo mã màu hex
            const uniqueColors = [...new Set(variants.map(v => v.color))]; // Lấy tất cả các màu unique
            uniqueColors.forEach(color => {
                const label = document.createElement('label');
                label.classList.add('me-3');
                label.innerHTML = `<input type="radio" name="color" value="${color}" class="form-check-input" style="background-color:${color};"> ${color}`;
                colorOptionsDiv.appendChild(label);
            });
            console.log(variants);

            // Cập nhật giá và số lượng khi chọn màu
            updatePriceAndQuantity(selectedSize, colorOptionsDiv.querySelector('input[name="color"]:checked')?.value);
        });

        // Xử lý sự kiện chọn màu
        document.getElementById('color-options').addEventListener('change', function () {
            const selectedSize = document.querySelector('input[name="size"]:checked')?.value;
            const selectedColor = document.querySelector('input[name="color"]:checked')?.value;
            if (!selectedSize || !selectedColor) return;

            updatePriceAndQuantity(selectedSize, selectedColor);
        });

        // Cập nhật giá và số lượng theo size và màu đã chọn
        function updatePriceAndQuantity(size, color) {
            if (!size || !color) return;

            const selectedVariant = variants.find(v => v.size === size && v.color === color);
            if (selectedVariant) {
                document.getElementById('product-price').textContent = selectedVariant.price.toLocaleString() + " VND";
                document.getElementById('product-quantity').textContent = `Số lượng còn lại: ${selectedVariant.quantity}`;
            }
        }

    </script>


</body>

</html>